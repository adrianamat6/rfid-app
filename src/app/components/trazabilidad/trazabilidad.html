<aside class="sidebar">
  <div class="sidebar-logo">âš¡</div>
  <div class="sidebar-avatar">AA</div>
  <div class="sidebar-icon">â†’</div>
  <div class="sidebar-bottom">
    <div class="sidebar-icon">âš™</div>
    <div class="sidebar-icon">ðŸ‘¤</div>
  </div>
</aside>

<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <h1>LÃ­nea de Trazabilidad</h1>
    <div style="display:flex; gap:8px; align-items:center;">
      <button class="btn-ghost" (click)="clearAll()">â†º Limpiar</button>
      <button class="btn-primary" (click)="openSaveModal()" [disabled]="!canSave">
        ðŸ’¾ Guardar
      </button>
      <button class="btn-ghost" routerLink="/operario">ðŸ“¡ Modo Escaneo</button>
      <button class="btn-ghost" routerLink="/inventario">ðŸ“¦ Inventario</button>

    </div>
  </div>

  <div class="content">

    <!-- STATS -->
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-icon" style="background:#ede9fe;">ðŸ”—</div>
        <div>
          <div class="stat-label">Puntos configurados</div>
          <div class="stat-value">{{ locations.length }}</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:#d1fae5;">âœ“</div>
        <div>
          <div class="stat-label">LÃ­nea activa</div>
          <div class="stat-value">{{ isActive ? 'SÃ­' : 'No' }}</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon" style="background:#fef3c7;">â†’</div>
        <div>
          <div class="stat-label">Conexiones</div>
          <div class="stat-value">{{ connectionsCount }}</div>
        </div>
      </div>
    </div>

    <!-- INPUT -->
    <div class="card">
      <div class="card-title">AÃ±adir punto de trazabilidad</div>
      <div class="input-row">
        <input
          class="text-input"
          type="text"
          placeholder="Introduce ubicaciÃ³n a trazar..."
          [(ngModel)]="inputLocation"
          (keydown.enter)="addLocation()"
        />
        <button class="btn-add" (click)="addLocation()">
          <span>+</span> AÃ±adir punto
        </button>
        <button class="btn-ghost" (click)="clearAll()">Limpiar</button>
      </div>
    </div>

    <!-- PIPELINE -->
    <div class="card">
      <div class="pipeline-header">
        <div class="card-title" style="margin:0">Flujo de trazabilidad</div>
        <div class="badge">
          <div class="badge-dot"></div>
          <span>{{ locations.length }} nodo{{ locations.length !== 1 ? 's' : '' }}</span>
        </div>
      </div>

      <div class="pipeline">

        <div class="empty-state" *ngIf="locations.length === 0">
          <div class="empty-icon">â—ˆ</div>
          <p>Sin puntos configurados</p>
          <span>AÃ±ade el primer punto para construir la lÃ­nea</span>
        </div>

        <ng-container *ngFor="let loc of locations; let i = index; let last = last">

          <div class="node" [style.animation-delay]="(i * 0.04) + 's'">
            <div class="node-header">
              <span class="node-index">P-{{ (i + 1).toString().padStart(2, '0') }}</span>
              <div style="display:flex; align-items:center; gap:6px;">
                <div class="node-status"></div>
                <button class="node-delete" (click)="removeLocation(i)" title="Eliminar">âœ•</button>
              </div>
            </div>
            <div class="node-body">
              <div class="node-name">{{ loc }}</div>
              <div class="node-sub">Punto de control</div>
            </div>
          </div>

          <div class="arrow" *ngIf="!last" [style.animation-delay]="(i * 0.04 + 0.05) + 's'">
            <div class="arrow-track"></div>
            <div class="arrow-head"></div>
          </div>

        </ng-container>

      </div>
    </div>

  </div>

  <!-- MODAL -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <h2>ðŸ’¾ Guardar configuraciÃ³n</h2>
      <p>Asigna un nombre para identificar esta lÃ­nea de trazabilidad.</p>
      <label class="modal-label">Nombre de la configuraciÃ³n</label>
      <input
        class="modal-input"
        type="text"
        placeholder="Ej: LÃ­nea A - ProducciÃ³n 2025"
        maxlength="60"
        [(ngModel)]="configNameInput"
        (keydown.enter)="saveConfig()"
        (keydown.escape)="closeModal()"
        autofocus
      />
      <div class="modal-actions">
        <button class="btn-ghost" (click)="closeModal()">Cancelar</button>
        <button class="btn-primary" (click)="saveConfig()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div
    class="toast"
    [class.show]="toastVisible"
    [class.success]="toastType === 'success'"
    [class.danger]="toastType === 'danger'"
  >
    {{ toastMessage }}
  </div>

</div>